<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>PBS Files - NIU Metis Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_1_1.html"><strong aria-hidden="true">1.1.</strong> Connecting to Metis</a></li><li class="chapter-item expanded "><a href="chapter_1_2.html"><strong aria-hidden="true">1.2.</strong> Remote Workspaces in VSCode</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Basic Metis Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_2_1.html"><strong aria-hidden="true">2.1.</strong> Building a C++ Project from the Ground Up</a></li><li class="chapter-item expanded "><a href="chapter_2_2.html"><strong aria-hidden="true">2.2.</strong> Building a CUDA Project from the Ground Up</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">3.</strong> Intermediate Metis Usage with Docker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_3_1.html"><strong aria-hidden="true">3.1.</strong> Using Pre-Made Docker Images</a></li><li class="chapter-item expanded "><a href="chapter_3_2.html"><strong aria-hidden="true">3.2.</strong> Using GPU Acceleration With Docker</a></li><li class="chapter-item expanded "><a href="chapter_3_3.html"><strong aria-hidden="true">3.3.</strong> Creating Your Own Docker Image</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_4.html"><strong aria-hidden="true">4.</strong> Advanced Metis Usage Techniques</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_4_1.html"><strong aria-hidden="true">4.1.</strong> SSH Automation with Metis</a></li><li class="chapter-item expanded "><a href="chapter_4_2.html"><strong aria-hidden="true">4.2.</strong> Conceptual Techniques</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_5.html"><strong aria-hidden="true">5.</strong> Command Quick Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_5_1.html"><strong aria-hidden="true">5.1.</strong> Bash</a></li><li class="chapter-item expanded "><a href="chapter_5_2.html"><strong aria-hidden="true">5.2.</strong> Podman and Docker</a></li><li class="chapter-item expanded "><a href="chapter_5_3.html"><strong aria-hidden="true">5.3.</strong> Modules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_5_3_1.html"><strong aria-hidden="true">5.3.1.</strong> Creating Modulefiles</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_5_4.html"><strong aria-hidden="true">5.4.</strong> PBS Professional</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_5_4_1.html" class="active"><strong aria-hidden="true">5.4.1.</strong> PBS Files</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="chapter_6.html"><strong aria-hidden="true">6.</strong> Conclusion, Citations, and Contact</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NIU Metis Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="541-pbs-files"><a class="header" href="#541-pbs-files">5.4.1. PBS Files</a></h1>
<p>This chapter is a summary of the <a href="https://www.utrgv.edu/hpcc/_files/documents/pbspro-user-guide.pdf">PBS Professional User Guide</a> and the <a href="https://www.jlab.org/hpc/PBS/qsub.html"><code>qsub</code> manual</a>, which are fantastic resources if you want to learn more about PBS Professional or <code>.pbs</code> files.</p>
<p>Metis has many users, and each user could have a myriad of reqiurements for their application. In order to accommodate each user fairly, and to optimize the execution of jobs, CRCD uses <a href="https://altair.com/pbs-professional/">PBS Professional</a> by Altair.</p>
<p>Job scripts written for PBS Professional are effectively script files, but alsoe define the parameters and requirements for job execution. These scripts are then run on the batch server, also known as the <strong>compute nodes</strong>.</p>
<h4 id="what-does-a-pbs-file-look-like"><a class="header" href="#what-does-a-pbs-file-look-like">What Does a <code>.pbs</code> File Look Like?</a></h4>
<pre><code>#!/bin/bash

#PBS -N hello_world
#PBS -j oe
#PBS -l select=1:ncpus=1:mpiprocs=1:ngpus=1:mem=2gb
#PBS -l walltime=00:15:00
#--PBS -m ae
#--PBS -M account@niu.edu

# Navigate to our working directory
PROJECT_DIRECTORY=/home/&lt;your_account_username&gt;/projects/cpp/cpp_on_metis
echo "The job's working directory is $PROJECT_DIRECTORY"
cd $PROJECT_DIRECTORY

# Run our script
./my_binary
</code></pre>
<p>There are three special properties of a <code>.pbs</code> file we should understand!</p>
<h2 id="pbs-directives"><a class="header" href="#pbs-directives">PBS Directives</a></h2>
<p>PBS directives are prefaced by <code>#PBS</code>, and specify PBS-specific job flags.</p>
<p>These are actually the exact flags that are effectively passed to the <code>qsub</code> command!</p>
<p>For instance, you could specify your email in two different ways:</p>
<pre><code class="language-pbs">...

#PBS -M you@niu.edu

...
</code></pre>
<p>...or, with the command flag: <code>qsub -M you@niu.edu</code>.</p>
<p>To comment out a PBS directive, replace <code>#PBS</code> with <code>#--PBS</code>.</p>
<p><em>It's worth noting that providing a flag by CLI will override the directives in the PBS file, which can be helpful if you want default values that can (optionally!) be specified differently at time of submission.</em></p>
<p><strong>Common Directives</strong>:</p>
<ul>
<li>
<p><code>#PBS -N &lt;name&gt;</code> or <code>qsub -N &lt;name&gt;</code></p>
<p>This will specify the name of the job in the PBS system, emails, and file output.</p>
<p>Example Usage:</p>
<pre><code class="language-bash">$ qsub -N hello_world run.pbs
20000.cm
$ ls
hello_world.o20000
</code></pre>
</li>
<li>
<p><code>#PBS -l &lt;resource_1&gt;:...:&lt;resource_n&gt;</code> or <code>qsub -l &lt;resource_1&gt;,...,&lt;resource_n&gt;</code></p>
<p>Specifies the resources that the job needs. You can find more about the types to specify in the <a href="https://www.utrgv.edu/hpcc/_files/documents/pbspro-user-guide.pdf">PBS User's Guide</a>, but the template that CRCD provides is very ideal.</p>
<p>Example (<code>run.pbs</code> file):</p>
<pre><code class="language-pbs">#Note - on Metis
#              Nchunks&lt;=32, for GPU chunks
#              Nchunks&lt;=4096/Ncpus for CPU-only chunks
#              (run 'shownodes' command to find the number of free cpus)
#              Ncpus&lt;=128, the total number of CPUs per node is 128
#              NPmpi&lt;=Ncpus, the total number of CPUs allocated for MPI tasks,
#                              request NPmpi=Ncpus for non-OPENMP jobs
#              Ngpus==1,  the total number of GPUs per node is 1
#              X&lt;=256,  28 of 32 Metis modes have 256 GB of RAM
#                       special jobs can request up to 1024 GB of RAM (4 nodes)
#
# Below, we request two chunks;
#  each chunk needs 8 CPUs, 8 MPI processes, 1 GPU card, and 16 GB RAM,
#  and we expect the total job runtime (walltime) to be 15 minutes.
#PBS -l select=1:ncpus=8:mpiprocs=8:ngpus=16:mem=2gb
#PBS -l walltime=00:15:00
</code></pre>
<p>To learn how to optimize these values, see the <a href="https://www.niu.edu/crcd/current-users/getting-started/queue-commands-job-management.shtml#jobcontrol">official Metis protocol</a>.</p>
</li>
<li>
<p><code>#PBS -j &lt;n | oe&gt;</code> or <code>qsub -j &lt;n | oe&gt;</code></p>
<p>Specifies whether the standard error stream should be merged with the standard output stream.</p>
<p>Specifying <code>oe</code> means that both <code>stderr</code> and <code>stdout</code> will be in the same output file.</p>
<p>Specifying <code>n</code>, or not specifying at all, means they will be in different files.</p>
<pre><code class="language-bash">$ qsub -j n run.pbs
20000.cm
$ ls
hello_world.o20000
hello_world.e20000
</code></pre>
</li>
<li>
<p><code>#PBS -m &lt;n | a*b*e*&gt;</code> or <code>qsub -m &lt;n | a*b*e*&gt;</code></p>
<p>Specifies when mail about your job should be sent, with the following key:</p>
<ul>
<li>To send mail when it aborts, add <code>a</code></li>
<li>To send main when it begins, add <code>b</code></li>
<li>To send main when it ends, add 'e'</li>
<li>To not send mail, specify <code>n</code> or do not use this directive.</li>
</ul>
</li>
<li>
<p><code>#PBS -M &lt;email&gt;</code> or <code>qsub -M &lt;email&gt;</code></p>
<p>Specifies the email any job alert emails should be sent to.</p>
<p>Email should only ever be sent to NIU-based emails for additional security.</p>
</li>
</ul>
<h2 id="pbs-environment-variables"><a class="header" href="#pbs-environment-variables">PBS Environment Variables</a></h2>
<p>There are two types of environment variables. Those which are prefaced by <code>PBS_O_</code> are influenced by the job's originating environment (the user environment!). Those which are prefaced by <code>PBS_</code> are provided by PBS.</p>
<p>All examples are from a <code>.pbs</code> file, as these environment variables are only populated inside a batch job.</p>
<p><strong>Common Environment Variables</strong>:</p>
<ul>
<li>
<p><code>TMPDIR</code></p>
<p>This is one of the most important directories, as it's deleted when the job finishes.</p>
<p>Any build artifacts, unimportant files, or other ephemeral content should be stored in this directory - this will make your job much cleaner!</p>
<p>Example PBS Usage and Output:</p>
<pre><code class="language-pbs">echo "This job's temporary directory is: '$TMPDIR'"
This job's temporary directory is '/scratch/pbs.20000.cm'
</code></pre>
</li>
<li>
<p><code>PBS_O_HOME</code></p>
<p>The home folder of the user running the command.</p>
<p>Example PBS Usage and Output:</p>
<pre><code class="language-pbs">echo "My home directory is: '$PBS_O_HOME'"
My home directory is: '/home/you'
</code></pre>
</li>
<li>
<p><code>PBS_O_LOGNAME</code></p>
<p>The username of the invoking user.</p>
<p>Example PBS Usage and Output:</p>
<pre><code class="language-pbs">echo "My login username is: '$PBS_O_LOGNAME'"
My login username is 'you'
</code></pre>
</li>
<li>
<p><code>PBS_O_PATH</code></p>
<p>The PATH environment variable from the invoking user.</p>
<p>Example PBS Usage and Output:</p>
<pre><code class="language-pbs">echo "My path is: '$PBS_O_PATH'"
My path is: '/urs/new/bin:/usr/local/bin:/bin'
</code></pre>
</li>
<li>
<p><code>PBS_O_SHELL</code></p>
<p>The shell of the invoking user.</p>
<p>Example PBS Usage and Output:</p>
<pre><code class="language-pbs">echo "My shell path is: '$PBS_O_SHELL'"
My shell path is: '/sbin/csh'
</code></pre>
</li>
<li>
<p><code>PBS_O_HOST</code></p>
<p>The machine hostname of the server.</p>
<p>Example PBS and Output:</p>
<pre><code class="language-pbs">echo "The machine hostname: '$PBS_O_HOST'"
The machine hostname: 'metis'
</code></pre>
</li>
<li>
<p><code>PBS_O_WORKDIR</code></p>
<p>The user's working directory (at time of invocation).</p>
<p>Example PBS and Output:</p>
<pre><code class="language-pbs">echo "My current working directory: '$PBS_O_WORKDIR'"
My current working directory: '/home/you'
</code></pre>
</li>
<li>
<p><code>PBS_JOBID</code></p>
<p>The ID of the batch job.</p>
<p>Example PBS Usage and Output:</p>
<pre><code class="language-pbs">echo "The ID of this job: '$PBS_JOBID'"
The ID of this job: '16386.cm'
</code></pre>
</li>
</ul>
<h3 id="the-shebang"><a class="header" href="#the-shebang">The Shebang</a></h3>
<p>At the top of the script, we can see the <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">shebang</a>.</p>
<p>A shebang specifier which interpreter PBS should use. In almost every case, it's best to use <a href="https://www.gnu.org/software/bash/">Bash</a>, which is located at <code>/bin/bash</code>.</p>
<p><em>This line is reqiured, but likely doesn't need to be modified!</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="chapter_5_4.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="chapter_6.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="chapter_5_4.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="chapter_6.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
